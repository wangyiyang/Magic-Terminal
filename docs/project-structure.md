# Magic Terminal é¡¹ç›®ç»“æ„

## ğŸ“ æ€»ä½“ç›®å½•ç»“æ„

```
Magic-Terminal/
â”œâ”€â”€ .github/                    # GitHub ç›¸å…³é…ç½®
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE/         # Issue æ¨¡æ¿
â”‚   â””â”€â”€ workflows/              # GitHub Actions å·¥ä½œæµ
â”œâ”€â”€ assets/                     # é™æ€èµ„æºæ–‡ä»¶
â”œâ”€â”€ cmd/                        # å‘½ä»¤è¡Œç¨‹åºå…¥å£
â”‚   â””â”€â”€ fyneterm/               # ä¸»åº”ç”¨ç¨‹åº
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ img/                        # è¯´æ˜æ–‡æ¡£å›¾ç‰‡
â”œâ”€â”€ internal/                   # å†…éƒ¨åŒ…ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â””â”€â”€ widget/                 # å†…éƒ¨ç»„ä»¶
â”œâ”€â”€ scripts/                    # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ test_data/                  # æµ‹è¯•æ•°æ®æ–‡ä»¶
â”œâ”€â”€ *.go                        # æ ¸å¿ƒåº“æ–‡ä»¶
â”œâ”€â”€ *_test.go                   # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ go.mod                      # Go æ¨¡å—å®šä¹‰
â”œâ”€â”€ go.sum                      # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ Makefile                    # æ„å»ºè„šæœ¬
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—æ–‡ä»¶

### ä¸»è¦ Go æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶å | åŠŸèƒ½æè¿° | å…³é”®ç±»å‹/å‡½æ•° |
|--------|----------|---------------|
| `term.go` | ç»ˆç«¯æ ¸å¿ƒé€»è¾‘ | `Terminal`, `Config` |
| `term_unix.go` | Unix å¹³å°å®ç° | PTY å¤„ç†, ä¿¡å·ç®¡ç† |
| `term_windows.go` | Windows å¹³å°å®ç° | ConPTY æ”¯æŒ |
| `input.go` | è¾“å…¥å¤„ç† | é”®ç›˜ã€é¼ æ ‡äº‹ä»¶ |
| `output.go` | è¾“å‡ºå¤„ç† | æ–‡æœ¬è¾“å‡ºã€æ ¼å¼åŒ– |
| `render.go` | æ¸²æŸ“å¼•æ“ | æ˜¾ç¤ºé€»è¾‘ã€æ€§èƒ½ä¼˜åŒ– |
| `color.go` | é¢œè‰²ç®¡ç† | é¢œè‰²è§£æã€ANSI é¢œè‰² |
| `escape.go` | è½¬ä¹‰åºåˆ— | ANSI/VT100 åè®® |
| `osc.go` | OSC å‘½ä»¤ | æ“ä½œç³»ç»Ÿå‘½ä»¤å¤„ç† |
| `apc.go` | APC å‘½ä»¤ | åº”ç”¨ç¨‹åºå‘½ä»¤å¤„ç† |
| `mouse.go` | é¼ æ ‡å¤„ç† | é¼ æ ‡äº‹ä»¶ã€é€‰æ‹©æ“ä½œ |
| `select.go` | æ–‡æœ¬é€‰æ‹© | é€‰æ‹©é€»è¾‘ã€å¤åˆ¶ç²˜è´´ |
| `position.go` | ä½ç½®ç®¡ç† | å…‰æ ‡ä½ç½®ã€åæ ‡è½¬æ¢ |

### æµ‹è¯•æ–‡ä»¶ç»“æ„

æ¯ä¸ªæ ¸å¿ƒæ¨¡å—éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶ï¼š
- `*_test.go`: å•å…ƒæµ‹è¯•
- æµ‹è¯•è¦†ç›–æ ¸å¿ƒåŠŸèƒ½å’Œè¾¹ç•Œæƒ…å†µ
- ä½¿ç”¨ `testify` æ¡†æ¶è¿›è¡Œæ–­è¨€

## ğŸ“¦ cmd/ ç›®å½•è¯¦è§£

### fyneterm/ - ä¸»åº”ç”¨ç¨‹åº

```
cmd/fyneterm/
â”œâ”€â”€ main.go                     # åº”ç”¨ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ theme.go                    # ä¸»é¢˜é…ç½®
â”œâ”€â”€ FyneApp.toml               # Fyne åº”ç”¨é…ç½®
â”œâ”€â”€ data/                       # é™æ€æ•°æ®
â”‚   â”œâ”€â”€ bundled.go             # åµŒå…¥èµ„æº
â”‚   â”œâ”€â”€ icons.go               # å›¾æ ‡å®šä¹‰
â”‚   â”œâ”€â”€ fyne_logo.png          # Logo æ–‡ä»¶
â”‚   â”œâ”€â”€ Icon.png               # åº”ç”¨å›¾æ ‡
â”‚   â””â”€â”€ Icon.svg               # çŸ¢é‡å›¾æ ‡
â”œâ”€â”€ translation/               # å›½é™…åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ en.json                # è‹±è¯­
â”‚   â”œâ”€â”€ fr.json                # æ³•è¯­
â”‚   â”œâ”€â”€ pl.json                # æ³¢å…°è¯­
â”‚   â”œâ”€â”€ pt_BR.json             # å·´è¥¿è‘¡è„ç‰™è¯­
â”‚   â”œâ”€â”€ ru.json                # ä¿„è¯­
â”‚   â”œâ”€â”€ sk.json                # æ–¯æ´›ä¼å…‹è¯­
â”‚   â”œâ”€â”€ sv.json                # ç‘å…¸è¯­
â”‚   â”œâ”€â”€ ta.json                # æ³°ç±³å°”è¯­
â”‚   â””â”€â”€ uk.json                # ä¹Œå…‹å…°è¯­
â””â”€â”€ Magic Terminal.app/        # macOS åº”ç”¨åŒ…
    â””â”€â”€ Contents/
        â”œâ”€â”€ Info.plist         # macOS åº”ç”¨ä¿¡æ¯
        â”œâ”€â”€ MacOS/
        â”‚   â””â”€â”€ magic-terminal # å¯æ‰§è¡Œæ–‡ä»¶
        â””â”€â”€ Resources/
            â””â”€â”€ icon.icns      # macOS å›¾æ ‡
```

#### main.go ä¸»è¦åŠŸèƒ½
```go
// åº”ç”¨ç¨‹åºå…¥å£
func main() {
    // è§£æå‘½ä»¤è¡Œå‚æ•°
    // åˆå§‹åŒ–åº”ç”¨ç¨‹åº
    // è®¾ç½®å›½é™…åŒ–
    // åˆ›å»ºä¸»çª—å£
    // å¯åŠ¨ç»ˆç«¯
}

// æ ¸å¿ƒç»„ä»¶
- setupListener()    // é…ç½®ç›‘å¬å™¨
- guessCellSize()   // è®¡ç®—å­—ç¬¦å¤§å°
- termTitle()       // è®¾ç½®çª—å£æ ‡é¢˜
```

## ğŸ”’ internal/ ç›®å½•

### widget/ - å†…éƒ¨ç»„ä»¶

```
internal/widget/
â”œâ”€â”€ termgrid.go                 # ç»ˆç«¯ç½‘æ ¼ç»„ä»¶
â”œâ”€â”€ termgridhelper.go          # ç½‘æ ¼åŠ©æ‰‹å‡½æ•°
â””â”€â”€ termgridhelper_test.go     # ç½‘æ ¼ç»„ä»¶æµ‹è¯•
```

#### TermGrid ç»„ä»¶
```go
type TermGrid struct {
    widget.BaseWidget
    
    // ç½‘æ ¼æ•°æ®
    cells     [][]Cell
    rows      int
    cols      int
    
    // æ¸²æŸ“ç›¸å…³
    cellSize  fyne.Size
    fontFace  font.Face
    
    // çŠ¶æ€ç®¡ç†
    cursor    Position
    selection Selection
}
```

**ä¸»è¦åŠŸèƒ½:**
- å­—ç¬¦ç½‘æ ¼çš„æ¸²æŸ“å’Œç®¡ç†
- å…‰æ ‡ä½ç½®è¿½è¸ª
- æ–‡æœ¬é€‰æ‹©å¤„ç†
- æ»šåŠ¨æ”¯æŒ
- æ€§èƒ½ä¼˜åŒ–çš„é‡ç»˜é€»è¾‘

## ğŸ”§ scripts/ ç›®å½•

### æ„å»ºå’Œéƒ¨ç½²è„šæœ¬

```
scripts/
â”œâ”€â”€ release.sh                  # å‘å¸ƒè„šæœ¬
â”œâ”€â”€ create-dmg.sh              # macOS DMG åˆ›å»º
â””â”€â”€ create-dmg-background.sh   # DMG èƒŒæ™¯åˆ›å»º
```

#### release.sh è„šæœ¬åŠŸèƒ½
```bash
#!/bin/bash
# ä¸»è¦åŠŸèƒ½ï¼š
# 1. ç‰ˆæœ¬éªŒè¯å’Œæ£€æŸ¥
# 2. æ„å»ºå¤šå¹³å°äºŒè¿›åˆ¶
# 3. åˆ›å»º Git æ ‡ç­¾
# 4. è§¦å‘ CI/CD æµç¨‹
# 5. ç”Ÿæˆ CHANGELOG
```

## ğŸ“‹ .github/ ç›®å½•

### GitHub Actions å·¥ä½œæµ

```
.github/
â”œâ”€â”€ ISSUE_TEMPLATE/             # Issue æ¨¡æ¿
â”‚   â”œâ”€â”€ bug_report.md          # Bug æŠ¥å‘Šæ¨¡æ¿
â”‚   â”œâ”€â”€ feature_request.md     # åŠŸèƒ½è¯·æ±‚æ¨¡æ¿
â”‚   â””â”€â”€ question.md            # é—®é¢˜å’¨è¯¢æ¨¡æ¿
â””â”€â”€ workflows/                  # CI/CD å·¥ä½œæµ
    â”œâ”€â”€ ci.yml                 # æŒç»­é›†æˆ
    â”œâ”€â”€ build-and-release.yml  # æ„å»ºå’Œå‘å¸ƒ
    â”œâ”€â”€ platform-tests.yml     # å¹³å°æµ‹è¯•
    â”œâ”€â”€ platform_tests.yml     # å¹³å°æµ‹è¯•ï¼ˆå¤‡ç”¨ï¼‰
    â”œâ”€â”€ security.yml           # å®‰å…¨æ‰«æ
    â””â”€â”€ static_analysis.yml    # é™æ€åˆ†æ
```

#### å·¥ä½œæµè¯´æ˜

| å·¥ä½œæµ | è§¦å‘æ¡ä»¶ | ä¸»è¦åŠŸèƒ½ |
|--------|----------|----------|
| `ci.yml` | Push/PR to main/develop | åŸºç¡€ CI æ£€æŸ¥ |
| `build-and-release.yml` | ç‰ˆæœ¬æ ‡ç­¾ | æ„å»ºå’Œå‘å¸ƒ |
| `platform-tests.yml` | Push/PR to main | è·¨å¹³å°æµ‹è¯• |
| `security.yml` | å®šæ—¶/æ‰‹åŠ¨ | å®‰å…¨æ¼æ´æ‰«æ |
| `static_analysis.yml` | Push/PR | ä»£ç è´¨é‡åˆ†æ |

## ğŸ“„ é…ç½®æ–‡ä»¶

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `go.mod` | Go æ¨¡å— | ä¾èµ–ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ |
| `go.sum` | ä¾èµ–é”å®š | ç¡®ä¿æ„å»ºå¯é‡ç°æ€§ |
| `Makefile` | æ„å»ºè„šæœ¬ | ç»Ÿä¸€çš„æ„å»ºå‘½ä»¤ |
| `.golangci.yml` | ä»£ç æ£€æŸ¥ | golangci-lint é…ç½® |
| `.gitignore` | Git å¿½ç•¥ | ç‰ˆæœ¬æ§åˆ¶å¿½ç•¥è§„åˆ™ |

### Makefile ä¸»è¦ç›®æ ‡

```makefile
# ä¸»è¦æ„å»ºç›®æ ‡
build:          # æ„å»ºåº”ç”¨ç¨‹åº
test:           # è¿è¡Œæµ‹è¯•
lint:           # ä»£ç æ£€æŸ¥
clean:          # æ¸…ç†æ„å»ºæ–‡ä»¶
install:        # å®‰è£…åº”ç”¨ç¨‹åº
dev:            # å¼€å‘æ¨¡å¼è¿è¡Œ

# å‘å¸ƒç›¸å…³
release:        # åˆ›å»ºå‘å¸ƒ
tag:            # åˆ›å»º Git æ ‡ç­¾
push-tag:       # æ¨é€æ ‡ç­¾

# è·¨å¹³å°æ„å»º
build-linux:    # Linux æ„å»º
build-darwin:   # macOS æ„å»º  
build-windows:  # Windows æ„å»º
build-all:      # æ‰€æœ‰å¹³å°æ„å»º
```

## ğŸ¨ assets/ å’Œ img/ ç›®å½•

### é™æ€èµ„æº

```
assets/
â””â”€â”€ dmg-background.png          # macOS DMG èƒŒæ™¯å›¾

img/
â”œâ”€â”€ linux.png                  # Linux æˆªå›¾
â”œâ”€â”€ macos.png                  # macOS æˆªå›¾
â””â”€â”€ windows.png                # Windows æˆªå›¾
```

## ğŸ“Š test_data/ ç›®å½•

### æµ‹è¯•æ•°æ®æ–‡ä»¶

```
test_data/
â””â”€â”€ chn.pdf                    # ä¸­æ–‡æµ‹è¯•æ–‡ä»¶
```

**ç”¨é€”:**
- å•å…ƒæµ‹è¯•æ•°æ®
- é›†æˆæµ‹è¯•æ ·æœ¬
- æ€§èƒ½æµ‹è¯•åŸºå‡†
- å›½é™…åŒ–æµ‹è¯•

## ğŸ” æ¨¡å—ä¾èµ–å…³ç³»

### æ ¸å¿ƒä¾èµ–å›¾

```
main.go (fyneterm)
    â†“
Terminal (term.go)
    â†“
â”œâ”€â”€ Input (input.go)
â”œâ”€â”€ Output (output.go)  
â”œâ”€â”€ Render (render.go)
â”œâ”€â”€ Colors (color.go)
â”œâ”€â”€ Escape (escape.go)
â”œâ”€â”€ Mouse (mouse.go)
â””â”€â”€ Platform
    â”œâ”€â”€ Unix (term_unix.go)
    â””â”€â”€ Windows (term_windows.go)
```

### å†…éƒ¨ç»„ä»¶ä¾èµ–

```
Terminal
    â†“
TermGrid (internal/widget)
    â†“
â”œâ”€â”€ Cell Management
â”œâ”€â”€ Cursor Tracking
â”œâ”€â”€ Selection Handling
â””â”€â”€ Rendering Logic
```

## ğŸ“ ä»£ç ç»„ç»‡åŸåˆ™

### 1. æŒ‰åŠŸèƒ½åˆ†æ¨¡å—
- æ¯ä¸ªæ–‡ä»¶ä¸“æ³¨å•ä¸€åŠŸèƒ½åŸŸ
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
- æœ€å°åŒ–æ¨¡å—é—´è€¦åˆ

### 2. å¹³å°æŠ½è±¡
- å¹³å°ç‰¹å®šä»£ç éš”ç¦»
- ç»Ÿä¸€çš„æ¥å£è®¾è®¡
- æ¡ä»¶ç¼–è¯‘æ”¯æŒ

### 3. æµ‹è¯•å¯¹åº”
- æ¯ä¸ªæ¨¡å—å¯¹åº”æµ‹è¯•æ–‡ä»¶
- å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- ä¾¿äºç»´æŠ¤å’ŒéªŒè¯

### 4. èµ„æºç®¡ç†
- é™æ€èµ„æºåµŒå…¥
- å›½é™…åŒ–æ”¯æŒ
- ç‰ˆæœ¬åŒ–èµ„æºç®¡ç†

---

æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒï¼š
- [æ¶æ„è®¾è®¡](./architecture.md)
- [æ¨¡å—è®¾è®¡](./module-design.md)
- [å¼€å‘æŒ‡å—](./development-setup.md)
